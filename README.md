# graduate-project
[Jins API](https://jins-meme.github.io/sdkdoc2/)を利用して、瞬きの間隔の時間を取得する。瞬きと疲労度(目による)との関係性を用いて、疲労がたまる(VDT症候群などになる)前に適切な休憩タイミングの提示を行う。
そのために、このリポジトリでは上記のようなデータを取得しグラフにするまでの自動化を行っていく。

# 使い方
```bash
#オプションを確認
python main.py -h
```
## Google Driveからデータを取得
```bash
python main.py -w yyyymmdd -d
```
どのデータを取得したいかは、日付の指定までならできる。~~時間の指定まではできない~~。また、`logicIndexData`か`summaryData`かは`main.py`にある`jins_meme_data_name`変数で変更できる。
今のところは、`summaryData`しか使う予定はない。
### 時間の指定
時間の指定もできるようになった。スクリプトを実行したら、取得したいデータの時間を指定(12-14)すると指定したデータだけ`Google Drive`から取得するようになった。(`download_file_path`のファイル名に含まれる時間と入力された時間でフィルターにかけることで実現)

## Google Driveからデータを削除
```bash
python main.py -w yyyymmmdd -D
```
どのデータを削除するかは、日付の指定までならできる。

## グラフの作成
```bash
python main.py -w yyyymmdd -cG
#実行するとどの時間帯のデータをグラフにするか入力を求められる
```
どのデータでグラフを作るかは、日付の指定と時間の指定もできる。例えば、`15`とすれば15時での実験の結果のグラフを作成する。`15-16`とすれば、15時から16時での実験の結果のグラフを作成する。注意点は、**この場合実験開始時刻が15時なので`16`と指定はできない**(プログラムは実行されない)。`keyword`で作るグラフのデータも変更できる。

### 疲労度のファイルパス
疲労度のファイルパスはJins memeがGoogle Driveに作成したCSVファイルの中にある`date`キーの値(時間)を使っている。また、`pass_time`という経過時間は`datetime.datetime.now`と`start_time`([`get_start_time`というコードを参考](https://github.com/haruya3/graduate-project/blob/master/my_google/my_drive/helper.py#L37))を元にしている。**この`date`キーの値と`pass_time`の値にはずれが生じることがある**。`date`キーの時間が`datetime.datetime.now`と1分ほどずれる時があり、それによって5分毎に疲労度のファイルパスを読み取る処理で疲労度のファイルパスもずれてしまい読みこめない。
#### そこで読み込めなかった疲労度のファイルパスを表示することで、そのファイルパスを1分ほどずらせば読み込めるようにできるよう改良した。
ファイルパスを1分ずらせば`date`キーのずれを解消して`pass_time`で5分毎のタイミングに合わせることができる。

## 分析
```bash
python main.py -w yyyymmdd -a
```
疲労度ごとの瞬目の間隔時間について分析できる。以下のような分析でき、その結果を取得できる。
- 表の作成
  - 瞬目の間隔時間について平均値や最大値・最小値について作成できる
    - 形式はtablefmtで指定していて今は**html形式**となっている
- グラフの作成
  - 縦軸: 瞬目の間隔時間についての平均値、横軸: 疲労度→折れ線グラフ
  - 縦軸: 瞬目の間隔時間、 横軸: 疲労度→相関図
    - ヒストグラムを作成するためのDataframe型のデータを表示できる 
    - ヒストグラムの作成は[このサイト](https://keisan.casio.jp/exec/system/1413957945)でできる
## 疲労度の記録
```bash
python fatigue.py
```
実行すると、作業開始時間の入力が求められる。作業開始から5分毎に疲労度を入力していく。これにより、「瞬目の間隔時間平均」と「疲労度」を「VDT作業開始時からの経過時間」で結びつけることができる(**疲労度のファイルパスが経過時間(5分毎)と対応している**)。
詳しい仕様は[こちらのPR](https://github.com/haruya3/graduate-project/pull/5)を参考に。

# 「休憩あり」の場合の休憩を促す
```bash
python rest.py
```
まず実験の開始時間を入力する。**1分毎に`Google Drive`からデータを取得してきた瞬目の間隔時間平均値と閾値を比較している**。閾値より瞬目の間隔時間平均値が高くなったら、ウィンドウに「休憩してください」と通知して休憩を促す。瞬目の間隔時間平均値が閾値より低くなったらウィンドウに「作業に戻っても大丈夫です」のように疲労が少し回復したことを通知する。
また、この実験中の「経過時間」・「瞬目の間隔時間平均値」・「疲労度」の3つの情報を1分ごとにリアルタイムなデータをコンソールにて表示する。
